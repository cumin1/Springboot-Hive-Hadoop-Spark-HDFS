<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>主成份分析PCA计算与应用</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
		<link rel="stylesheet" type="text/css" href="css/link1.css"/>
		<script id="MathJax-script" async src="../js/es5/tex-chtml.js"></script>
		<script>
		MathJax = {
		  tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
		};
		</script>
	</head>
	<body class="container-fluid">		
		<h2 class="my-5 hnav">主成份分析PCA计算与应用</h2>
		<div id="right_nav">
			<ul>
				<li class="active">知识</li>
				<li>实训</li>
				<li>拓展</li>
				<li class='last'>顶部</li>
			</ul>
		</div>
		<h3 class="mb-3 son_wrap" id='knowledge'>一、知识</h3>
		<p>主成分分析法PCA（principal components analysis）是一种简化数据集方法，本质上是一个线性变换。这个变换把高维数据变换到一个低维坐标系统中，使得任何数据投影的第一大方差在第一个坐标(称为第一主成分)上，第二大方差在第二个坐标(第二主成分)上，依次类推。主成分分析经常用于减少数据集的维数，同时保持集的对方差贡献最大的特征。这是通过保留低阶主成分，忽略高阶主成分做到的，这样低阶成分往往能够保留住数据的最重要方面。</p>
		<div class="text-center"><img src="img/1-4-1.png" ></div>
		<div class="text-center small">图1&nbsp;&nbsp;使所有样本的投影尽可能分开（如投影到红线），则需最大化投影点的方差</div>		
		<ol>
			<li>
				<h5>为什么要进行数据降维?<span class="ktitle ml-5 badge badge-light badge-pill">show more</span></h5>
				<div class="kdetails">
					<p class="mt-3">(1)算法复杂度呈指数级关联，当数据维度过大时，会消耗过多的计算机资源；<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)各维数据间常常存在相关性，可以在保证算法性能的前提下，通过合理的降维方法，将信息的损失降到最低。</p>
					<p>协方差矩阵:包含了各维度自身的方差信息，也包含了各维度间的协方差信息(即相关性信息)，因此计算协方差矩阵是数据降维过程中的重要步骤。</p>
				</div>
			</li>
			<li>
				<h5>PCA计算<span class="ktitle ml-5 badge badge-light badge-pill">show more</span></h5>				
				<div class="kdetails">
					<p>假$X$为数据集，$X=(X_1,X_2,\cdots,X_n)，X_i \in R^d$，将维度降到$d'$&lt;$d$。</p>
		<p>算法如下：</p>
		<p>（1）给定样本集$X=\{X_1,X_2,\cdots,X_n\}$和低维空间维数$d'$；</p>
		<p>（2）对所有样本进行中心化：$x_i=x_i-\frac{1}{n}\sum_{i=1}^{n}x_i$；</p>
		<p>（3）计算样本的协方差矩阵$XX^T$；</p>
		<p>（4）对协方差矩阵$XX^T$做特征值分解：$\lambda_1 \ge \lambda_2 \ge \cdots \ge \lambda_d$；</p>
		<p>（5）取最大的$d'$个特征值所对应的特征向量$w_1,w_2,\cdots,w_{d'}$；</p>
		<p>（6）输出投影矩阵$W=(w_1,w_2,\cdots,w_{d'})$。</p>
		<P>低维空间维数$d'$可用户事先指定，或从重构的角度设置一个重构阈值，例如t=90%，然后选取使下式成立的最小$d'$值：$$\frac{\sum_{i=1}^{d'}\lambda_i}{\sum_{i=1}^{d}\lambda_i} \ge t$$</p>
				</div>									
			</li>			
		</ol>
		<h3 class="mt-5 mb-3 son_wrap" id="training">二、实训</h3>
		<h6><b class="task">任务：</b>MNIST数据集包含了0-9共10类手写数字图片,每张图片都做了尺寸归一化，都是28x28大小的灰度图。MNIST数据集包含四个部分：</h6>
		<p>训练集图像：train-images-idx3-ubyte.gz（9.9MB，包含60000个样本）</p>
		<p>训练集标签：train-labels-idx1-ubyte.gz（29KB，包含60000个标签）</p>
		<p>测试集图像：t10k-images-idx3-ubyte.gz（1.6MB，包含10000个样本）</p>
		<p>测试集标签：t10k-labels-idx1-ubyte.gz（5KB，包含10000个标签）</p>
		<p>指定的维度K，用PCA进行降维。</p>		
		<div><b>要求：</b>请用Python实现。</div>		
		<p><kbd>Step1</kbd>&nbsp;&nbsp;导入库</p>
		<p class="p-code">
			<code>#导入numpy库<br/>import numpy as np<br>
			import matplotlib.pyplot as plt<br>
			from sklearn.datasets import load_digits</code>&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-sm btn-primary copyBtn">复制</button>
		</p>
		<p><kbd>Step2</kbd>&nbsp;&nbsp;加载手写数字数据集</p>
		<p class="p-code">
		<code>#load_digits 函数加载手写数字数据集<br>digits = load_digits()<br>#将特征存储在变量 X 中<br>X = digits.data<br>#将标签存储在变量 y 中<br>y = digits.target</code>&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-sm btn-primary copyBtn">复制</button>
		</p>
		<p><kbd>Step3</kbd>&nbsp;&nbsp;绘制降维前的图像</p>
		<p class="p-code">
			<code>fig, ax = plt.subplots(nrows=2, ncols=5, sharex=True, sharey=True, figsize=(10, 5))<br>ax = ax.flatten()<br>for i in range(10):<br>&nbsp;&nbsp;&nbsp;&nbsp;#选取每个数字类别中的第一个样本，将其转换成 8x8 的图像并展示出来。<br>&nbsp;&nbsp;&nbsp;&nbsp;img = X[y == i][0].reshape(8, 8)<br>&nbsp;&nbsp;&nbsp;&nbsp;ax[i].imshow(img, cmap='Greys')<br>ax[0].set_xticks([])<br>ax[0].set_yticks([])<br>plt.tight_layout()<br>plt.show()</code>&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-sm btn-primary copyBtn">复制</button>
		</p>
		<p><kbd>Step4</kbd>&nbsp;&nbsp;PCA 的实现过程（维度为2）</p>
		<p class="p-code">
			<code>#计算样本的均值向量<br>mean_vec = np.mean(X, axis=0)<br>#计算样本的协方差矩阵<br>cov_mat = np.cov(X.T)<br>#计算协方差矩阵特征值与特征向量<br>eig_vals, eig_vecs = np.linalg.eig(cov_mat)<br>#将特征向量按照对应的特征值大小排序<br>sorted_idx = np.argsort(eig_vals)[::-1]<br>sorted_eig_vals = eig_vals[sorted_idx]<br>sorted_eig_vecs = eig_vecs[:, sorted_idx]<br>k = 2<br>#选取前两个特征向量组成投影矩阵<br>projection_mat = sorted_eig_vecs[:, :k]<br>#将原始数据点乘以投影矩阵，得到降维后的数据 X_pca<br>X_pca = X.dot(projection_mat)</code>&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-sm btn-primary copyBtn">复制</button>
		</p>
		<p><kbd>Step5</kbd>&nbsp;&nbsp;绘制降维后的图像</p>
		<p class="p-code">
			<code>colors = ['red', 'blue', 'green', 'purple', 'yellow', 'orange', 'pink', 'cyan', 'gray', 'brown']<br>plt.figure(figsize=(10, 8))<br>#根据每个样本的标签将其在降维空间中的坐标进行着色<br>for i in range(len(colors)):<br>&nbsp;&nbsp;&nbsp;&nbsp;plt.scatter(X_pca[y == i, 0], X_pca[y == i, 1], c=colors[i], label=str(i), edgecolor='k')<br>plt.xlabel('Principal Component 1')<br>plt.ylabel('Principal Component 2')<br>plt.legend(title='Digit')<br>plt.title('PCA on MNIST Dataset')<br>plt.show()</code>&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" class="btn btn-sm btn-primary copyBtn">复制</button>
		</p>
		<div><b>Out:</b></div>
		<div class="container-fluid text-center"><img src="img/1-4-2.jpg" ></div>
		<div class="container-fluid text-center"><img src="img/1-4-3.jpg" ></div>
		<h3 id="extend" class="son_wrap mt-5">三、拓展</h3>
		<p><b class="task">任务：</b>Iris数据集以鸢（yuān）尾花的特征作为数据来源，由3种不同类型的鸢尾花的50个样本数据构成。<br>样本特征（属性）：Sepal.Length（花萼长度）、Sepal.Width（花萼宽度）、Petal.Length（花瓣长度）、Petal.Width（花瓣宽度），单位是cm。<br>种类：Iris Setosa（山鸢尾）、Iris Versicolour（杂色鸢尾）、Iris Virginica（维吉尼亚鸢尾）。
鸢尾花数据的特征维数是4，利用PCA进行降维到2维。
&nbsp;&nbsp;&nbsp;&nbsp;<button class="btn btn-sm btn-success" id='tips'>点击查看答案</button></p>		
		<div class="answer">Python代码：
			<p><kbd>Step1</kbd>&nbsp;&nbsp;导入库</p>
			<p class="p-code">
				<code>from sklearn.decomposition import PCA<br>from sklearn.datasets import load_iris<br>import pandas as pd</code>
			</p>
			<p><kbd>Step2</kbd>&nbsp;&nbsp;加载示例数据集iris</p>
			<p class="p-code">
				<code>iris = load_iris()<br>df = pd.DataFrame(iris.data, columns=iris.feature_names)</code>
			</p>
			<p><kbd>Step3</kbd>&nbsp;&nbsp;调用实例化PCA对象，选择要降到的维数2</p>
			<p class="p-code">
				<code>pca = PCA(n_components=2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 降到2个主成分</code>
			</p>
			<p><kbd>Step4</kbd>&nbsp;&nbsp;对数据进行PCA分析</p>
			<p class="p-code">
				<code>pca_result = pca.fit_transform(df)</code>
			</p>
			<p><kbd>Step5</kbd>&nbsp;&nbsp;输出结果</p>
			<p class="p-code">
				<code>print(pca_result)</code>
			</p>
			<div><b>Out：</b></div>
			<div>[[-2.68412563  0.31939725]<br> [-2.71414169 -0.17700123]<br>[-2.88899057 -0.14494943]<br>[-2.74534286 -0.31829898]<br>[-2.72871654  0.32675451]<br> [-2.28085963  0.74133045]<br> [-2.82053775 -0.08946138]<br> [-2.62614497  0.16338496]<br>………………………………………….]]</div>			
		</div>
		<div class="program" draggable="true">
			<div class="pro-text card bg-light">
				<form>
					<h3 class="card-title">程序调试<button type="button" class="close"><span>&times;</span></button></h3>
					<textarea id='pro'></textarea><br/>
					<div class="card-footer">
						<input type="submit" value="运行程序" class="btn btn-info"/>
						<input type="reset" name="" id="pro-clear" value="清空" class="btn btn-warning"/>
					</div>					
				</form>
			</div>
			<div id='pro-result'>
				此处显示运行结果
			</div>
		</div>
		<script src="../js/jquery-3.4.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/bootstrap.bundle.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/link.js" type="text/javascript" charset="utf-8"></script>
	</body>
</html>
